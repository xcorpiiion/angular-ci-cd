name: Angular CI Pipeline

# ==========================================
# 1. O GATILHO DA QUEST (Aggro)
# O rob√¥ (GitHub Actions) s√≥ acorda e inicia a Dungeon quando
# voc√™ mandar c√≥digo (push) direto para a branch principal (main).
# ==========================================
on:
  push:
    branches: [ "master" ]

jobs:
  batalha-ci:
    # ==========================================
    # 2. A ARENA (Servidor)
    # Aluga um PC tempor√°rio zerado rodando a √∫ltima vers√£o do Linux Ubuntu.
    # Ele nasce, toma a porrada, roda o script e √© destru√≠do no final.
    # ==========================================
    runs-on: ubuntu-latest

    # ==========================================
    # 3. O COMBO DE HABILIDADES (Passo a passo)
    # ==========================================
    steps:
      # PASSO 1: LOAD NO SAVE STATE
      # O Ubuntu nasce com o HD vazio. Essa a√ß√£o nativa baixa todo o seu c√≥digo
      # do reposit√≥rio pra dentro dessa m√°quina virtual.
      - name: ‚¨áÔ∏è Baixando o Save State (Checkout do c√≥digo)
        uses: actions/checkout@v4

      # PASSO 2: EQUIPANDO A ARMA CERTA
      # O Linux puro n√£o tem Node. Aqui a gente instala o Node.js Level 22
      # pra garantir que o servidor tenha o mesmo ambiente do seu PC.
      - name: ‚öôÔ∏è Equipando o Node.js (Level 22)
        uses: actions/setup-node@v4
        with:
          node-version: '24.10.0'

      # PASSO 3: COMPRANDO OS ITENS (INVENT√ÅRIO)
      # O 'npm ci' (Clean Install) √© a vers√£o hardcore do 'npm install'.
      # Ele l√™ o package-lock.json e baixa as vers√µes EXATAS dos pacotes,
      # sem inventar moda ou tentar atualizar nada sozinho. Mais r√°pido e seguro.
      - name: üì¶ Comprando os itens (Instalando depend√™ncias)
        run: npm ci

      # PASSO 4: O FISCAL (LINTER)
      # O ESLint vai varrer o c√≥digo ca√ßando console.log ou vari√°veis in√∫teis
      # usando as nossas regras hardcore. Achou erro? Insta-Kill (o pipeline quebra).
      - name: üßê Passando pelo Fiscal (ESLint)
        run: npx ng lint

      # PASSO 5: A PORRADARIA (TESTES AUTOMATIZADOS)
      # Bate no c√≥digo pra ver se a l√≥gica de HP/Dano funciona.
      # --watch=false: Impede o teste de ficar rodando num loop infinito.
      # ChromeHeadless: Roda um Chrome "fantasma" (sem interface gr√°fica),
      # j√° que o servidor Ubuntu n√£o tem monitor.
      - name: ‚öîÔ∏è Enfrentando o Boss (Rodando os Testes)
        run: npm run test -- --watch=false --browsers=ChromeHeadless

      # PASSO 6: O LOOT FINAL (BUILD)
      # Se o c√≥digo sobreviveu aos testes e ao  fiscal, o Angular compila o TypeScript,
      # otimiza os arquivos e gera a pasta 'dist' pronta pra ir pro servidor Nginx.
      - name: üõ†Ô∏è Forjando o Loot Final (Build do Angular)
        run: npm run build

      # ==========================================
      # PASSO 7: A FORJA FINAL (DOCKER)
      # O c√≥digo t√° perfeito! Agora o rob√¥ l√™ nosso Dockerfile
      # e cria a imagem de produ√ß√£o misturando o Angular com o Nginx.
      # ==========================================
      - name: üê≥ Criando a Imagem Docker
        run: docker build -t meu-angular-app .
